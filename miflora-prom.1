.\" Generated by Mmark Markdown Processer - mmark.miek.nl
.TH "USER COMMANDS" 1 "January 2025" "" ""

.SH "NAME"
.PP
miflora\-prom \- generate prometheus metrics from Xiaomi Mi flower care plant sensor

.SH "SYNOPSIS"
.PP
\fBmiflora\-prom\fP

.SH "DESCRIPTION"
.PP
miflora\-prom is a small application that connects to a Xiami Mi flower plant sensor over blue tooth
and converts the sensor data into prometheus metrics. If needs a config file in \fB\fC/etc/miflora\fR to
operate.

.PP
The data retrieved and the prometheus metrics are:

.IP \(bu 4
battery level, \fB\fCmiflora_meta_battery_percentage{name="<alias>"}\fR
.IP \(bu 4
firmware version, \fB\fCmiflora_meta_firmware_version{name="<alias>", version="<version>"}\fR
.IP \(bu 4
illumination level in Lux, \fB\fCmiflora_plant_illumination_lux{name="<alias>"}\fR
.IP \(bu 4
moisture percentage, \fB\fCmiflora_plant_moisture_percentage{name="<alias>"}\fR
.IP \(bu 4
ground conductivity, \fB\fCmiflora_plant_conductivity{name="<alias>"}\fR


.PP
When running as a non\-root user the following capabilities are needed:
'CAP_NET_RAW' and 'CAP_NET_ADMIN' for \fB\fCmiflora-prom\fR to accessing bluetooth and sending packets.

.PP
Under Linux, the application uses the mac address to connect to devices; under MacOs the UUID.

.SH "CONFIG FILE"
.PP
The configuration file contains lines constisting of a \fB\fCLHS <colon> RHS\fR. It defines the MAC
addreses or UUIDs of the sensors to be queried and two other variables:

.PP
.RS

.nf
# adapter, defaults to 'default'
adapter: default
# how often to query the sensors
duration: 1h
# the sensor's aliases and their uuid or mac address
myfirstsensor: 422b23155c369dfee0aea210d1a9bc37
mysecondsensor: ...

.fi
.RE

.SH "ACKNOWLEDGMENTS"
.IP \(bu 4
Xiaomi for creating the sensor.
.IP \(bu 4
Creators of go\-ble
\[la]https://github.com/go-ble/ble\[ra].
.IP \(bu 4
Creators of miflora wiki
\[la]https://github.com/ChrisScheffler/miflora/wiki/The-Basics\[ra].


